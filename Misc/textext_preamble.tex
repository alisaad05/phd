%%%%%% PS:  Textext-compatible preamble, the "\text" is hence replaced by "\textup"

%%------------------------ FONTS -------------------------------
\usepackage{Utopia} % Utopia font-typesetting including mathematical formula compatible with newer TeX-Distributions (>2010)
% \usepackage{mathpazo}
%% ------------------------ MATHs commands--------------------------

\newcommand\bin[3]{#1-\SI{#2}{\ucomposition} #3}	% used in textup
\newcommand\tern[5]{#1-\SI{#2}{\ucomposition} #3-\SI{#4}{\ucomposition} #5} % used in textup

%\renewcommand{matrix}[1]{#1 \rangle} 
\newcommand{\avg}[1]{\ensuremath{\langle  #1 \rangle}}
\newcommand{\brac}[1]{\ensuremath{\left(  #1 \right)}} 
\newcommand{\curly}[1]{\ensuremath{\left\{  #1 \right\}}}
\newcommand{\crochet}[1]{ \left[  #1  \right] } 
\newcommand{\abval}[1]{\ensuremath{\left |  #1 \right |}} 
\newcommand\norm[1]{\ensuremath{\lVert #1 \rVert}}

\renewcommand\d{\ensuremath{\partial}}
\newcommand\integral[3]{\ensuremath{\int_{#1} #2\: \mathrm{d}#3}}
\newcommand{\deriv}[1]{\frac{\partial #1 }{\partial t}}
\newcommand{\diff}[2]{ \ensuremath{\nabla \cdot \brac{ #1 \nabvec #2}}}
\newcommand\temp[1]{\ensuremath{\frac{\partial}{\partial t} \brac{#1} }} 
\newcommand\tempup[1]{\ensuremath{\frac{\partial #1}{\partial t} }} 

%\newcommand{\mtrx}[1]{{\underline{\underline{#1}}} }
\newcommand{\mtrx}[1]{{\overline{\overline{#1}}} }
\newcommand{\mat}[1]{{\overline{\overline{#1}}} }


\newcommand\hilbert{\ensuremath{\mathscr{H}^1}}
\newcommand\order{\ensuremath{\mathscr{O}}}
\newcommand\test{\ensuremath{\mathscr{W}}}
\newcommand\interp{\ensuremath{\mathscr{P}}}
\newcommand\Mij{\ensuremath{\mathscr{M}_{ij}}}
\newcommand\Aij{\ensuremath{\mathscr{A}_{ij}}}
\newcommand\Kija{\ensuremath{\mathscr{K}1_{ij}}} % diffusion term
\newcommand\Kijb{\ensuremath{\mathscr{K}2_{ij}}} % boundary condition
\newcommand\Fi{\ensuremath{\mathscr{F}_{i}}}
\newcommand\Si{\ensuremath{\mathscr{S}_{i}}}
\newcommand\Ohm{\ensuremath{\Omega}}
\newcommand\dOhm{\ensuremath{\partial \Ohm}}
\newcommand\OhmE{\ensuremath{\Ohm_E}}
\newcommand\dOhmE{\ensuremath{\partial \OhmE}}
\newcommand\element{\ensuremath{\Ohm_E}}
\newcommand\brent{\ensuremath{{\brac{\tau}}}}
\newcommand\brentplus{\ensuremath{{\brac{\tau+1}}}}
\newcommand\brentzero{\ensuremath{{\brac{\tau=0}}}}
%--------------------------
\newcommand\itersymbol{\nu}
%--------------------------
\newcommand\iter{\ensuremath{{\brac{\itersymbol}}}}
\newcommand\iterplus{\ensuremath{{\brac{\itersymbol+1}}}}
\newcommand\iterminus{\ensuremath{{\brac{\itersymbol-1}}}}
\newcommand\dRdH{\ensuremath{\frac{dR}{dH}}}
\newcommand\dRdT{\ensuremath{\frac{dR}{dT}}}
\newcommand\dTdH{\ensuremath{\frac{dT}{dH}}}
\newcommand\dTdHjt{\ensuremath{\brac{dT/dH}_j^{t}}}
\newcommand\dTdHjk{\ensuremath{\brac{dT/dH}_j^{\iter}}}
\newcommand\dTdHjkplus{\ensuremath{\brac{dT/dH}_j^{\iterplus}}}
\newcommand\dHdT{\ensuremath{\frac{dH}{dT}}} 
\newcommand\dHdTjk{\ensuremath{\brac{dH/dT}_j^{\iter}}}
\newcommand\dHdTjkplus{\ensuremath{\brac{dH/dT}_j^{\iterplus}}}
\newcommand\dHdTjt{\ensuremath{\brac{dH/dT}_j^{t}}}
\newcommand\dRdTijk{\ensuremath{\brac{\frac{dR}{dT}}_{ij}^{\iter}}}
\newcommand\dRdHijk{\ensuremath{\brac{\frac{dR}{dH}}_{ij}^{\iter}}}
\newcommand\Rjk{\ensuremath{R_{j}^{\iter}}}

\newcommand\nabvec{\ensuremath{\vec{\nabla}}}
\newcommand\nabmat{\ensuremath{\mat{\nabla}}}
\newcommand\nabmattransp{\ensuremath{\mat{\nabla^\textup{t}}}}
\newcommand\vit{\ensuremath{\avg{\vec{v^l}}}}  
\newcommand\vitf{\ensuremath{\avg{\vf}}}
\newcommand\vita{\ensuremath{\avg{\va}}}
\newcommand\strainrate{\ensuremath{\avg{\mat{\dot{\varepsilon}^l}}}}
\newcommand\I{\ensuremath{\mat{\mathrm{I}}}}  

%TODO :redundant defnitions rh and rhoh
%TODO :redundant defnitions rhv and rhohv
\renewcommand\r{\ensuremath{\avg{ \rho }}}
\newcommand\rl{\ensuremath{\avg{ \rho }^l}}
\newcommand\h{\ensuremath{\avg{ h }}}
\newcommand\rh{\ensuremath{\avg{ \rho h }}}
\newcommand\rhoh{\ensuremath{\avg{ \rho h }}}
\newcommand\rhv{\ensuremath{\avg{ \rho h \vec{v} }}}
\newcommand\rhohv{\ensuremath{\avg{ \rho h \vec{v} }}}
\newcommand\rcp{\ensuremath{\avg{ \rho C_p }}}

\newcommand\w{\ensuremath{\avg{w}}}
\newcommand\wi{\ensuremath{\avg{w_i}}}
%\newcommand\wil{\ensuremath{\avg{w_i}^l}}
\newcommand\wil{\ensuremath{w_i^l}}
\newcommand\wis{\ensuremath{w_i^s}}
\newcommand\gphi{\ensuremath{{g^{\phi}} }}
\newcommand\wiphi{\ensuremath{\wi^\phi}}
\newcommand\rphi{\ensuremath{\rho^{\phi} }}
\newcommand\hphi{\ensuremath{h^{\phi} }}
\newcommand\Tk{\ensuremath{T^\iter}}
\newcommand\Tkplus{\ensuremath{T^\iterplus}}
\newcommand\Tkinit{\ensuremath{T^{\brac{k=0}}}}
\newcommand\Hk{\ensuremath{\rh^{\brac{k}}}}
\newcommand\Hkinit{\ensuremath{\rh^{\brac{k=0}}}}
\newcommand\source{\ensuremath{\avg{\dot{Q}_{{V}}}}}
\newcommand\Hj{\ensuremath{H_j}}
\newcommand\Hjt{\ensuremath{H_j^t}}
\newcommand\Hjk{\ensuremath{H_j^\iter}}
\newcommand\Hjkminus{\ensuremath{H_j^{\iterminus}}}
\newcommand\Hjkplus{\ensuremath{H_j^{\iterplus}}}
\newcommand\Hkplus{\ensuremath{H^{\iterplus}}}
\newcommand\Hjtminus{\ensuremath{H_j^{t-\dt}}}
\newcommand\Hjtplus{\ensuremath{H_j^{t+\dt}}}
\newcommand\deltaHk{\ensuremath{\Delta H^\iter}}
\newcommand\deltaHkplus{\ensuremath{\Delta H^\iterplus}}
\newcommand\Tj{\ensuremath{T_j}}
\newcommand\Tjt{\ensuremath{T_j^t}}
\newcommand\Tjk{\ensuremath{T_j^\iter}}
\newcommand\Tjkminus{\ensuremath{T_j^{\iterminus}}}
\newcommand\Tjkplus{\ensuremath{T_j^{\iterplus}}}
\newcommand\Tjtminus{\ensuremath{T_j^{t-\dt}}} 
\newcommand\Tjtplus{\ensuremath{T_j^{t+\dt}}} 
\newcommand\nosum{\textup{no sum on }j} 

%TODO :redundant defnitions rhoref and rref
\newcommand\rhoref{\ensuremath{\rho_{\textup{ref}}}}
\newcommand\rref{\ensuremath{\rho_{\textup{ref}}}}
\newcommand\rholref{\ensuremath{\rho_{0}^{l}}}
\newcommand\Tref{\ensuremath{T_{0}}}
\newcommand\wlref{\ensuremath{w_{0}^l}}
\newcommand\wilref{\ensuremath{\wi_{0}^l}}
\newcommand\betaT{\ensuremath{\beta_T}}
\newcommand\betawl{\ensuremath{\beta_{\wl}}}
\newcommand\betawil{\ensuremath{\beta_{\wil}}}
\newcommand\betawlC{\ensuremath{\beta_{\avg{w_\textup{C}}^l}}}
\newcommand\betawlCR{\ensuremath{\beta_{\avg{w_\textup{Cr}}^l}}}

\newcommand\wavg{\ensuremath{\avg{w}}}
\newcommand\wC{\ensuremath{\avg{w_\textup{C}}}}
\newcommand\wCR{\ensuremath{\avg{w_\textup{Cr}}}}
\newcommand\wl{\ensuremath{\avg{w}^l}}
\newcommand\ws{\ensuremath{\avg{w}^s}}
\newcommand\wa{\ensuremath{\avg{w}^A}}
\newcommand\Cnominal{\ensuremath{{w}_0}}
\newcommand\Cl{\ensuremath{{w}^l}}
\newcommand\Clstar{\ensuremath{{w}^{l \textup{*}} }}
\newcommand\Cs{\ensuremath{{w}^s}}
\newcommand\Csstar{\ensuremath{{w}^{s \textup{*}} }}

\renewcommand\k{\ensuremath{k}}
\newcommand\ml{\ensuremath{{m}^l}}
\newcommand\ms{\ensuremath{{m}^s}}
\newcommand\pdas{\ensuremath{{\lambda}_{1}}}
\newcommand\sdas{\ensuremath{{\lambda}_{2}}} 
\newcommand\Tcoh{\ensuremath{{T}_{\textup{coh}}}} 
\newcommand\Fos{\ensuremath{\textup{Fo}^s}} % Fourier number in the solid
\newcommand\tsolidif{\ensuremath{t_\textup{s}}} % solidification time in Fourier number 
\newcommand\rev{\ensuremath{V_\textup{E}}} % V_\textup{RVE}
\newcommand\Vs{\ensuremath{V^s}}
\newcommand\Vl{\ensuremath{V^l}}
\newcommand\Vphi{\ensuremath{V^\phi}}
\newcommand\psis{\ensuremath{\avg{\psi}^s}}
\newcommand\psil{\ensuremath{\avg{\psi}^l}}
\newcommand\gammastar{\ensuremath{{\Gamma}^{\textup{*}} }}

\newcommand\rhof{\ensuremath{\rho^F}}
\newcommand\rhoa{\ensuremath{\rho^A}}
\newcommand\rhol{\ensuremath{\rho^l}}
\newcommand\rhos{\ensuremath{\rho^s}}
\newcommand\rhov{\ensuremath{\avg{\rho \vec{v}}}}
\newcommand\rholvl{\ensuremath{\rho^l \vl}}
\newcommand\rhosvs{\ensuremath{\rho^s \vs}}
\newcommand\cp{\ensuremath{C_p}}
\newcommand\cpl{\ensuremath{C_p^l}}
\newcommand\cps{\ensuremath{C_p^s}}
\newcommand\cpa{\ensuremath{C_p^A}}
\newcommand\kl{\ensuremath{\avg{\kappa^l}}}  % I added \avg
\newcommand\ks{\ensuremath{\avg{\kappa^s}}}	 % I added \avg
\newcommand\hf{\ensuremath{h^F}}
\newcommand\ha{\ensuremath{h^A}}
\newcommand\hl{\ensuremath{h^l}}
\newcommand\hs{\ensuremath{h^s}}
\newcommand\gf{\ensuremath{{g^F}}} % double braces useful for additional superscripts
\newcommand\ga{\ensuremath{{g^a}}} % double braces useful for additional superscripts
\newcommand\gl{\ensuremath{{g^l}}} % double braces useful for additional superscripts
\newcommand\gs{\ensuremath{{g^s}}} % double braces useful for additional superscripts
\newcommand\fl{\ensuremath{{f^l}}} % double braces useful for additional superscripts
\newcommand\fs{\ensuremath{{f^s}}} % double braces useful for additional superscripts
\newcommand\pf{\ensuremath{{p^F}}}
\newcommand\pl{\ensuremath{{p^l}}}
\newcommand\ps{\ensuremath{p^s}}
\newcommand\Da{\ensuremath{D^A}}
\newcommand\Dl{\ensuremath{D^l}}
\newcommand\Ds{\ensuremath{D^s}}
\newcommand\Dphi{\ensuremath{D^\phi}}
\newcommand\mul{\ensuremath{\mu^l}}
\newcommand\mus{\ensuremath{\mu^s}}
\newcommand\K{\ensuremath{\mathbb{K}}} %permeability
\newcommand\sigmal{\ensuremath{\mat{\sigma^l}}}
\newcommand\sigmas{\ensuremath{\mat{\sigma^s}}}

%interfaces (extra spaces are on purpose)
\newcommand\liqsol{\ensuremath{l\textup{-}s}}
\newcommand\liqair{\ensuremath{l\textup{-}a}}
\newcommand\solair{\ensuremath{s\textup{-}a}}
\newcommand\vliqsol{\ensuremath{\vec{v}^{\liqsol}}}
\newcommand\vliqair{\ensuremath{\vec{v}^{\liqair}}}
\newcommand\vsolair{\ensuremath{\vec{v}^{\solair}}}

\newcommand\vf{\ensuremath{\vec{v}^F}}
\newcommand\va{\ensuremath{\vec{v}^a}}
\newcommand\vl{\ensuremath{\vec{v}^l}}
\newcommand\vs{\ensuremath{\vec{v}^s}}
\newcommand\vphi{\ensuremath{\vec{v}^\phi}}
\newcommand\vphistar{\ensuremath{\vec{v}^{\phi_1/\phi_2}}}
\newcommand\vstar{\ensuremath{\vec{v}^\textup{*}}}
\newcommand\vlstar{\ensuremath{\vec{v}^{l \textup{*}}}}
\newcommand\vsstar{\ensuremath{\vec{v}^{s \textup{*}}}}

\newcommand\gravity{\ensuremath{\vec{g}}}

\newcommand\dt{\ensuremath{\Delta t}}
\newcommand\hext{\ensuremath{h_{\textup{\tiny{ext}}}}}
\newcommand\Text{\ensuremath{T_{\textup{\tiny{ext}}}}}
\newcommand\Ttop{\ensuremath{T_{\textup{\tiny{Top}}}}}
\newcommand\Tbottom{\ensuremath{T_{\textup{\tiny{Bottom}}}}}

\newcommand*\widefbox[1]{\fbox{\hspace{2em}#1\hspace{2em}}}

% From "Mixing Boussinesq" report
%\renewcommand\v{\ensuremath{\vec{v}}}  
\newcommand\Fv{\ensuremath{\vec{F}_{\textup{v}}^l}}  
\newcommand\rhog{\ensuremath{\rho \vec{g}}}  
\newcommand\rhobouss{\ensuremath{\widetilde{\rho}}} 
\newcommand\heaviside{\ensuremath{H}}  
\newcommand{\heavisideM}{ \ensuremath{\heaviside^M}}
\newcommand{\heavisideA}{ \ensuremath{\heaviside^A}}
\newcommand\dirac{\ensuremath{\delta \brac{\levelset}}}
\newcommand\levelset{\ensuremath{\alpha}}
\newcommand\levelsettest{\ensuremath{\alpha^\textup{*}}}
\newcommand\levelsetSUPG{\ensuremath{\alpha_{SUPG}^\textup{*}}}
\newcommand\levelsetx{\ensuremath{\levelset \brac{\vec{x}}}}
\newcommand{\mix}[1]{\ensuremath{\widehat{#1}}} % \widehat % \overbrace % \widetilde

% Common nouns and names
\newcommand{\registered}{\textsuperscript{\textregistered}}
\newcommand{\cimlib}{\emph{CimLib }}
\newcommand{\thercast}{\emph{Thercast\registered }}
\newcommand{\ccemlcc}{\emph{CCEMLCC }} 
\newcommand{\doitpoms}{\emph{© DoITPoMS, University of Cambridge}} 
\newcommand\HtoT{$\textup{H2T}$}
\newcommand\TtoH{$\textup{T2H}$}
\newcommand\carbide{\ensuremath{\textup{M}_7 \textup{C}_3}}

% Colors
\newcommand{\red}[1]{{\color{Red} #1}}
\newcommand{\blue}[1]{{\color{Blue} #1}} 