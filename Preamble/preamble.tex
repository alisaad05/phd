%%------------------------ FONTS -------------------------------
\usepackage{fourier} % Utopia font-typesetting including mathematical formula compatible with newer TeX-Distributions (>2010)
%\usepackage{utopia} % on older systems -> use this package instead of fourier in combination with mathdesign for better looking results
%\usepackage[adobe-utopia]{mathdesign}

%%------------------------ LANGUAGES-FRENCH ACCENTS -------------------------------
\usepackage[utf8]{inputenc}

%%------------------------ ACRONYMS -------------------------------
%\usepackage[printonlyused,smaller]{acronym}
%\renewcommand{\bflabel}[1]{{#1}\hfill} % fix the list of acronyms

%%------------------------ BIBLIOGRAPHY NATBIB (obsolete) -------------------------------
% http://merkel.zoneo.net/Latex/natbib.php
% default option for citation rendering is "authoryear" and "round" brackets
% sort: orders multiple citations into the sequence in which they appear in the list of references;
% sort&compress: as sort but in addition multiple numerical citations are compressed if possible (as 3-6, 15);

%\usepackage[square,numbers]{natbib}    % number in square , useful to add sortcompress
%\usepackage[square,sort]{natbib} % name and year in square

%%------------------------ BIBLIOGRAPHY BIBLATEX -------------------------------
\usepackage[american]{babel}% Recommended
\usepackage{csquotes}% Recommended
\usepackage [backend=bibtex,style=authoryear]{biblatex} %style=authoryear %style=apa
\newcommand{\citep}[1]{\parencite{#1}}
\newcommand{\citet}[1]{\textcite{#1}}
\ExecuteBibliographyOptions{hyperref=true,backref=true,firstinits=true, isbn=false, eprint=false,
							url=true, doi=false, sorting=nyt, minnames=1, maxcitenames=2, maxbibnames=2, 
							alldates=short, punctfont=true, autopunct=false, block=none, dashed=false}

\addbibresource{References/desktop_library.bib}

% Spacing
\setlength{\bibitemsep}{15pt} %vertical spacing
\setlength{\bibhang}{1cm} %label alignment (0 for perfect align)

% Disable URL dates
\AtEveryBibitem{%
    \clearfield{urldate}%
    \clearfield{urlday}%
    \clearfield{urlmonth}%
    \clearfield{urlyear}%
    \clearlist{language}
}%

%Fix the comma problem after the journal name (via addcomma)
\DeclareFieldFormat{journaltitle}{\mkbibemph{#1\isdot}\addcomma\space}

%Fix number and volume format
\renewbibmacro*{volume+number+eid}{%
  \printfield{volume}%
%  \setunit*{\adddot}% DELETED
  \setunit*{\addnbspace}% NEW (optional); there's also \addnbthinspace
  \printfield{number}%
  \setunit{\addcomma\space}%
  \printfield{eid}}
\DeclareFieldFormat[article]{number}{\mkbibparens{#1}}

%Disable In prefix
\renewbibmacro{in:}{}

% Define brackets instead of parenthesis
\makeatletter
\newrobustcmd*{\parentexttrack}[1]{%
  \begingroup
  \blx@blxinit
  \blx@setsfcodes
  \blx@bibopenparen#1\blx@bibcloseparen
  \endgroup}

\AtEveryCite{%
  \let\parentext=\parentexttrack%
  \let\bibopenparen=\bibopenbracket%
  \let\bibcloseparen=\bibclosebracket}
\makeatother

%define label before reference in list	
\renewbibmacro{begentry}{%
\textbf{[\printnames[][-\value{liststop}]{labelname}~\printfield{labelyear}\printfield{extrayear}}]\\}

%define full hyperlink for textcite
\DeclareCiteCommand{\textcite}
  {\boolfalse{cbx:parens}}
  {\usebibmacro{citeindex}%
   \printtext[bibhyperref]{\usebibmacro{textcite}}}
  {\ifbool{cbx:parens}
     {\bibcloseparen\global\boolfalse{cbx:parens}}
     {}%
   \multicitedelim}
  {\usebibmacro{textcite:postnote}}

%define full hyperlink for parencite  
 \DeclareCiteCommand{\parencite}[\mkbibparens]
  {\usebibmacro{prenote}}
  {\usebibmacro{citeindex}%
    \printtext[bibhyperref]{\usebibmacro{cite}}}
  {\multicitedelim}
  {\usebibmacro{postnote}}


%%------------------------ LAYOUT -------------------------------
%% --- Margins
\setlength{\textwidth}{146.8mm} % = 210mm - 37mm - 26.2mm
\setlength{\oddsidemargin}{11.6mm} % 37mm - 1in (from hoffset)
\setlength{\evensidemargin}{0.8mm} % = 26.2mm - 1in (from hoffset)
\setlength{\topmargin}{-2.2mm} % = 0mm -1in + 23.2mm 
\setlength{\textheight}{221.9mm} % = 297mm -29.5mm -31.6mm - 14mm (12 to accomodate footline with pagenumber)
\setlength{\headheight}{14pt}
%% --- Paragraph spacing
\setlength{\parindent}{0pt}
%% --- Interline spacing
\usepackage{setspace} % increase interline spacing slightly
\setstretch{1.1}

%%------------------------ Captions  -------------------------------

% Captions: This makes captions of figures use a boldfaced small font. 
\RequirePackage[small,bf]{caption}
\RequirePackage[labelsep=space,tableposition=top]{caption} 
%\renewcommand{\figurename}{Fig.} %to support older versions of captions.sty

%%-----------------------  Footnote Header formatting -------------------------------
% From EPFL template
%\usepackage[perpage]{footmisc} %Range of footnote options 

%\usepackage{fancyhdr}
%\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}
%\pagestyle{fancy}
%	\fancyhf{}
%	\renewcommand{\headrulewidth}{0.4pt}
%	\renewcommand{\footrulewidth}{0pt}
%	\fancyhead[OR]{\bfseries \nouppercase{\rightmark}}
%	\fancyhead[EL]{\bfseries \nouppercase{\leftmark}}
%	\fancyfoot[EL,OR]{\thepage}
%\fancypagestyle{plain}{
%	\fancyhf{}
%	\renewcommand{\headrulewidth}{0pt}
%	\renewcommand{\footrulewidth}{0pt}
%	\fancyfoot[EL,OR]{\thepage}}
%\fancypagestyle{addpagenumbersforpdfimports}{
%	\fancyhead{}
%	\renewcommand{\headrulewidth}{0pt}
%	\fancyfoot{}
%	\fancyfoot[RO,LE]{\thepage}
%}

%%------------------------ Figures  -------------------------------
%\usepackage{rotating}
%\usepackage{wrapfig}
%\usepackage{float}
%\usepackage{subfig} %note: subfig must be included after the `caption` package.
\usepackage{subcaption}
 

% \usepackage{graphicx,xcolor}
\usepackage[dvipsnames]{xcolor}
\definecolor{webgreen}{rgb}{0,.5,0}
\definecolor{webbrown}{rgb}{.6,0,0}
\definecolor{Maroon}{cmyk}{0, 0.87, 0.68, 0.32}
\definecolor{RoyalBlue}{cmyk}{1, 0.50, 0, 0}

%\graphicspath{{images/}}
\makeatletter
\setlength{\@fptop}{0pt}  % for aligning all floating figures/tables etc... to the top margin
\makeatother

%%------------------------ Tables  -------------------------------
%\usepackage{longtable}
%\usepackage{multicol}
%\usepackage{multirow}
%\usepackage{tabularx}

%\usepackage{booktabs}

%%------------------------ Math and SI Units  -------------------------------
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{siunitx} % http://ftp.oleane.net/pub/CTAN/macros/latex/contrib/siunitx/siunitx.pdf
% \num{.3e45}   ,  \num{3.45d-4}   , \numlist{10;30;50;70} ,  \numrange{10}{30} , 

%%------------------------ Cross References  -------------------------------
% --- Hyperref and Options
\usepackage{hyperref}
\hypersetup{%
	% --------------
	% PDF Display
	% --------------
    linktocpage=false, % make page number, not text, be link on TOC, LOF and LOT
    linktoc=all,
    pdfstartpage=1, 
    pdfstartview=FitV, % FitR (rectangle) % FitH %FitV % FitB (bounding box) % FitBH % FitBV
    %
    breaklinks=true, 
    pageanchor=true,  % put an anchor on every page, DO NOT TURN OFF
    pdfpagemode=UseOutlines,  % UseNone % UseOutlines (shows bookmarks)
    plainpages=false, % Forces page anchors to be named by the Arabic form of the page number, rather than the formatted form.
	%
    bookmarksnumbered, 
    bookmarksopen=true, 
    bookmarksopenlevel=1,%
	pdfpagelayout=SinglePage,  % TwoPageLeft % TwoPageRight
	hypertexnames=true, % use guessable names for links, DO NOT TURN OFF
    pdfhighlight=/O, % How link buttons behave when selected; /I is for inverse (the default) /N (no effect), /O (outline), and /P (inset highlighting).
	%
	% --------------
	% Hyperlink Colors
	% --------------  
	colorlinks=true,  
    urlcolor=webbrown, %webbrown %Black
    linkcolor=RoyalBlue, %RoyalBlue, %Black
    citecolor=webgreen, %webgreen, %Black
    pagecolor=RoyalBlue,%Black
	% --------------
    % PDF Information
	% --------------  
    pdftitle={\myTitle},%
    pdfauthor={\myName, \myUni, \myFaculty},%
    pdfkeywords={Macrosegregation, solidification, level set, numerical simulation}%
}


%% --- cleveref and Options
\usepackage{cleveref}
% cleverref should always be invoked AFTER hyperref

\DefineBibliographyStrings{english}{%
  backrefpage = {cited on page},% originally "cited on page"
  backrefpages = {cited on pages},% originally "cited on pages"
}

%% --- beckref and Options (NATBIB compatible - Obsolete)
%\newcommand{\backrefnotcitedstring}{\relax}%(Not cited.)
%\newcommand{\backrefcitedsinglestring}[1]{(cited on page~#1)}
%\newcommand{\backrefcitedmultistring}[1]{(cited on pages~#1)}
%\ifthenelse{\boolean{enable_backrefs}}%
%{%
%		\usepackage[hyperpageref]{backref}  % to be loaded after hyperref package
%		   \renewcommand{\backreftwosep}{ and~} % separate 2 pages
%		   \renewcommand{\backreflastsep}{, and~} % separate last of longer list
%		   \renewcommand*{\backref}[1]{}  % disable standard
%		   \renewcommand*{\backrefalt}[4]{% detailed backref
%		      \ifcase #1 %
%		         \backrefnotcitedstring%
%		      \or%
%		         \backrefcitedsinglestring{#2}%
%		      \else%
%		         \backrefcitedmultistring{#2}%
%		      \fi}%
%}%{\relax}    

%%--------------------- TOC --------
%\setcounter{secnumdepth}{2}
%\setcounter{tocdepth}{2}

\usepackage{minitoc} % use like this : \minitoc 
\setcounter{minitocdepth}{2}
\setlength{\mtcindent}{24pt} 
\renewcommand{\mtcfont}{\small\rm}
\renewcommand{\mtcSfont}{\small\bf}


%%------------------------ NOMENCLATURE / GLOSSARY -------------------------------
% http://www.latex-community.org/know-how/latex/55-latex-general/263-glossaries-nomenclature-lists-of-symbols-and-acronyms
%\usepackage[toc]{glossaries}
% use it like: \newglossaryentry{label}{definition}
%\usepackage[xindy,toc]{glossaries}  
%\makeglossaries 


%%------------------------ Names of sections for figures, nomenclature ...  -------------------------------
% To change the name of the Nomenclature section, uncomment the following line
%\renewcommand{\contentsname}{My Table of Contents}
%\renewcommand{\listfigurename}{My List of Figures}
%\renewcommand{\listtablename}{My List of Tables}
%\renewcommand{\nomname}{Symbols}

%%------------------------ Appendix -------------------------------
\usepackage[titletoc]{appendix}
% The default value of both \appendixtocname and \appendixpagename is `Appendices'. These names can all be changed via: 
%\renewcommand{\appendixtocname}{List of appendices}
\renewcommand{\appendixname}{Appendicitis}

%%------------------------ MISC PACKAGES -------------------------------
% Graphs
\usepackage{pgfplots}
\pgfplotsset{width=8cm,compat=newest}
%\usepgfplotslibrary{external}
%\tikzexternalize

% Format URLs
\usepackage{url}

% Input dummy text
\usepackage{lipsum}

\usepackage{pdfpages} %\includepdf[options]{filename}
%\usepackage{algpseudocode} 

% Display line number
\usepackage{lineno}
\ifthenelse{\boolean{enable_line_numbers}}%
{%
	%\linenumbers
	\pagewiselinenumbers % requires compiling AT LEAST twice
}{\relax}    

% Comments
\usepackage{todonotes}
\ifthenelse{\boolean{enable_visual_comments}}%
{% then
   \newcommand{\comment}[2][]{\todo[backgroundcolor=yellow!50!white, caption={#2}, inline, size=\small, #1]{\renewcommand{\baselinestretch}{0.5}\selectfont#2\par}}
}
{% else 
  \newcommand{\comment}[2][]{}
}

% Enchance syllable breaking avoiding bad boxes
\usepackage[stretch=10]{microtype} % which allows font expansion up to 1% (default is 2%)

% Cancel sign in math equations
\usepackage{cancel}

% Enables putting the pdf_tex graphics in a subfolder
\usepackage{import}


%%------------------------ ENVIRONMENTS  -------------------------------
% Change hyperlink color to black in miniTOC, TOC, TOF ...
\newenvironment{nolinkcolors}[1]{\begingroup \hypersetup{hidelinks}  #1 }{\endgroup}

%% Dorian Depriester: Figures centrées, et en position 'here, top, bottom or page'
\newenvironment{figureth}{
		\begin{figure}[htbp]
			\centering
	}{
		\end{figure}
		}
%**********
%% Tableaux centrés, et en position 'here, top, bottom or page'
\newenvironment{tableth}{
		\begin{table}[htbp]
			\centering
			%\rowcolors{1}{coleurtableau}{coleurtableau}
	}{
		\end{table}
		}
%**********	
\newenvironment{subfigureth}[1]{
	\begin{subfigure}[t]{#1}
	\centering
}{
	\end{subfigure}
}
%**********	
